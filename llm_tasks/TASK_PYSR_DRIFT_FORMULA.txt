TASK FOR PYSR - SYMBOLIC REGRESSION ON DRIFT EVOLUTION

MISSION: Use PySR to discover the mathematical formula for drift evolution

==================================================

BACKGROUND:

PySR successfully discovered: X_{k+1}[lane] = (X_k[lane])^n mod 256

Now we need it to discover: drift[k][lane] = f(k, lane)

==================================================

DATA PREPARATION:

INPUT FEATURES:
1. k (transition index: 1 to 70)
2. lane (lane number: 0 to 15)
3. steps_since_activation (k - lane×8)
4. exponent (exponent for this lane)

OUTPUT:
- drift[k][lane] (0-255)

DATASET SIZE:
- 340 evolution values (where k > lane×8)
- 764 zero values (where k < lane×8) - can exclude these

==================================================

SCRIPT TO CREATE:

experiments/01-pysr-symbolic-regression/train_drift_formula.py

```python
import json
import pandas as pd
from pysr import PySRRegressor

# Load drift data
with open('../../drift_data_CORRECT_BYTE_ORDER.json') as f:
    data = json.load(f)

EXPONENTS = [3, 2, 3, 2, 2, 3, 0, 2, 2, 3, 3, 2, 2, 2, 2, 3]

# Prepare training data (evolution values only)
features = []
targets = []

for trans in data['transitions']:
    k = trans['from_puzzle']

    for lane in range(16):
        activation_k = lane * 8 if lane > 0 else 1

        # Only use evolution values (k > activation_k)
        if k > activation_k:
            drift = trans['drifts'][lane]

            features.append({
                'k': k,
                'lane': lane,
                'steps_since_activation': k - activation_k,
                'exponent': EXPONENTS[lane]
            })
            targets.append(drift)

df = pd.DataFrame(features)
X = df.values
y = pd.Series(targets).values

# Train PySR
model = PySRRegressor(
    niterations=40,
    binary_operators=["+", "*", "-", "/", "mod"],
    unary_operators=["exp", "log", "square", "cube"],
    populations=20,
    population_size=50,
    maxsize=15,
    timeout_in_seconds=7200,  # 2 hours
    parsimony=0.001
)

model.fit(X, y)

# Save results
model.to_json('drift_formula_results.json')
print("Best formula:", model.sympy())
```

==================================================

RUN CONFIGURATION:

LOCATION: experiments/01-pysr-symbolic-regression/
TIME: 2-4 hours (let it run long enough)
OUTPUT: drift_formula_results.json

VARIATIONS TO TRY:

1. **Lane-specific models** (train 16 separate models)
   - May find simpler formulas per lane
   - Can parallelize

2. **Subset by exponent** (group lanes by n=2 vs n=3)
   - Exponent=2 lanes: [1, 3, 4, 7, 8, 11, 12, 13, 14]
   - Exponent=3 lanes: [0, 2, 5, 9, 10, 15]
   - Exponent=0 lane: [6] (special case)

3. **Time-based subsets** (k < 32, 32-64, >64)
   - Early, middle, late regimes

==================================================

SUCCESS CRITERIA:

LEVEL 1: 50-70% accuracy → Good progress, refine
LEVEL 2: 70-90% accuracy → Very good, almost there
LEVEL 3: 90-99% accuracy → Excellent, minor corrections
LEVEL 4: 100% accuracy → BREAKTHROUGH!

Even partial formulas are valuable:
- "Works for lane 0 only" = progress
- "Works for k<32 only" = progress
- "70% accurate" = useful for hybrid approach

==================================================

WHAT TO LOOK FOR IN RESULTS:

1. **Simple formulas** (best case)
   Example: drift = (k + lane*13) mod 256

2. **Piecewise formulas** (good case)
   Example: drift = f1(k) if k<32 else f2(k)

3. **Complex formulas** (still useful)
   Example: drift = (k^2 + lane*k + C) mod 256

4. **No pattern found** (still informative)
   Tells us to try other approaches

==================================================

PARALLELIZATION:

Run multiple PySR instances in parallel:

1. Lane 0 only (most data)
2. Exponent=2 lanes
3. Exponent=3 lanes
4. k<32 subset
5. k>=32 subset

Combine results afterward.

==================================================

INTEGRATION:

Once PySR finds formulas, test them:

```bash
cd /home/solo/LadderV3/kh-assist/experiments/01-pysr-symbolic-regression
python3 train_drift_formula.py
python3 validate_drift_formula.py  # Test on held-out data
```

==================================================

DELIVERABLES:

1. drift_formula_results.json - PySR output
2. best_drift_formula.txt - Human-readable formula
3. validation_accuracy.json - Test results
4. formula_code.py - Executable Python function

==================================================

COORDINATOR NOTE:

This is the MATHEMATICAL approach.
Combine with LLM analysis (nemotron, gpt-oss) for best results.

If PySR finds 80% formula + LLMs find patterns = 100% solution!

==================================================

STATUS: READY TO RUN

Waiting for orchestrator approval to launch PySR training.
